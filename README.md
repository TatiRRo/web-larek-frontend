# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:

- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом
- src/components/model/ — папка с Model
- src/components/presenter/ — папка с Presenter
- src/components/view/ — папка с View

Важные файлы:

- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск

Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```

## Сборка

```
npm run build
```

или

```
yarn build
```

## Архитектура приложения

Код приложения разделен на слои согласно парадигме MVP:

- слой данных, отвечает за хранение и изменение данных
- слой представления, отвечает за отображение данных на странице
- презентер, отвечает за связь представления и данных

### Базовые классы

#### Класс Api

Содержит в себе базовую логику отправки запросов. В конструктор передается базовый адрес сервера и опциональный объект с заголовками запросов.
Поля:

- `baseUrl:string` - базовый URL для всех запросов к серверу
- `options:RequestInit`- конфигурация запроса (заголовки и другие параметры)

Методы:

- `handleResponse(response: Response): Promise<object>` - функция для обработки ответа от сервера после выполнения fetch-запроса, защищенный метод
- `get(uri: string)` - выполняет GET запрос на переданный в параметрах ендпоинт и возвращает промис с объектом, которым ответил сервер
- `post(uri: string, data: object, method: ApiPostMethods = 'POST')` - принимает объект с данными, которые будут переданы в JSON в теле запроса, и отправляет эти данные на ендпоинт переданный как параметр при вызове метода. По умолчанию выполняется `POST` запрос, но метод запроса может быть переопределен заданием третьего параметра при вызове.

#### Класс EventEmitter

Брокер событий позволяет отправлять события и подписываться на события, происходящие в системе. Класс используется в презентере для обработки событий и в слоях приложения для генерации событий.
Поля:

- `_events:Map<EventName, Set<Subscriber>>` - коллекция всех событий и их подписчиков (обработчиков).

Методы:

- `on<T extends object>(eventName: EventName, callback: (event: T) => void)` - установить обработчик на событие
- `off(eventName: EventName, callback: Subscriber)` - снять обработчик с события
- `emit<T extends object>(eventName: string, data?: T)` - инициировать событие с данными
- `onAll(callback: (event: EmitterEvent) => void)` - слушать все события
- `offAll()` - сбросить все обработчики
- `trigger<T extends object>(eventName: string, context?: Partial<T>)` - сделать коллбек триггер, генерирующий событие при вызове

#### Класс Component

Класс `Component` — это базовый класс для работы с элементами DOM в дочерних компонентах. Предоставляет набор универсальных методов для управления отображением и состоянием элементов на странице.
Поля:

- `container:HTMLElement`- корневой HTML-элемент компонента, с которым работает класс.

Методы:

- `toggleClass(element: HTMLElement, className: string, force?: boolean) ` - переключить класс
- `setText(element: HTMLElement, value: string): void ` - установить текстовое содержимое
- `setDisabled(element: HTMLElement, state: boolean) ` - сменить статус блокировки кнопки
- `setHidden(element: HTMLElement)` - скрыть элемент, защищенный метод
- `setVisible(element: HTMLElement)` - показать элемент, защищенный метод
- `setImage(element: HTMLImageElement, src: string, alt?: string)` - установить изображение с алтернативным текстом, защищенный метод
- `render(data?: Partial<T>)` - вернуть корневой DOM-элемент

#### Класс Model

Класс Model — это базовая модель для работы с данными приложения. Используется как родительский класс для других моделей.

Методы:

- `emitChanges(event: string, payload?: object)` - сообщить всем что модель поменялась

### Класс Model

#### Класс WebLarekAPI

Класс `WebLarekAPI` — интерфейс, который описывает работу с API интернет-магазина.
Методы:

- `getProductList(): Promise<IProduct[]>` - получить список карточек товаров с сервера
- `postOrder(order: IOrderLot): Promise<IOrderResult>` - отправить заказ на сервер.

### Класс Presenter

#### Класс AppState

Класс AppState управляет состоянием приложения интернет-магазина, включая каталог товаров, корзину и данные заказа. Он предоставляет методы для изменения данных и уведомления других компонентов о изменениях через события.

Поля:

- `catalog: IProduct[]` - список товаров в каталоге
- `basketItems: string[]` - массив id товаров в корзине
- `basketTotal: number` - итоговая сумма корзины
- `preview: IProduct | null` - товар, открытый в режиме предпросмотра
- `contactsData: IOrderContactsData` - данные контактов для оформления заказа (адрес, телефон, email)
- `formErrors: FormErrors` - ошибки валидации формы заказа и контактов

Методы:

- `updateCatalog(list: IProduct[])` - устанавливает список товаров каталога и уведомляет об изменениях.
- `setPreview(item: IProduct)` - устанавливает товар для предпросмотра и уведомляет об изменениях.
- `addToBasket(productId: string)` - добавляет товар в корзину и пересчитывает итоговую сумму корзины, если необходимо, уведомляет об изменениях.
- `calculateBasketTotal()` - пересчитывает итоговую сумму корзины на основе текущих товаров в корзине.
- `removeFromBasket(productId: string)` - удаляет товар из корзины и пересчитывает итоговую сумму корзины, уведомляет об изменениях.
- `isInBasket(productId: string): boolean` - проверяет, есть ли товар с указанным id в корзине.
- `getBasketItems(): IProduct[]` - возвращает список товаров, находящихся в корзине.
- `clearBasket()` - очищает корзину и сбрасывает данные заказа, уведомляет об изменениях.
- `clearContactsData()` - сбрасывает данные контактов на значения по умолчанию.
- `setFormData(data: Partial<IOrderContactsData>)` - обновляет данные контактов на основе переданных данных и выполняет валидацию.

### Классы View

#### Класс Form

Класс `Form `— обеспечивает взаимодействие пользователя с формой, следит за корректностью ввода данных, управляет состоянием кнопки отправки и выводом ошибок.
Поля:

- `_submit: HTMLButtonElement` — кнопка отправки формы
- `_errors: HTMLElement` — элемент для отображения текста ошибки

Методы:

- `onInputChange(field: keyof T, value: string)` — защищённый метод для отслеживания изменений в полях ввода формы
- `set valid(value: boolean)` — сеттер для активации или деактивации кнопки отправки в зависимости от результата валидации
- `set errors(value: string)` — сеттер для отображения текста ошибки в форме
- `render(state: Partial<T> & IFormState)` — метод рендеринга формы и добавления обработчиков событий для полей ввода и кнопок выбора оплаты

#### Класс Modal

Класс `Modal` — отвечает за управление модальным окном в приложении: позволяет устанавливать контент, открывать и закрывать модальное окно, а также рендерить его в DOM.
Методы:

- `setContent(content: HTMLElement)` — установка содержимого модального окна
- `open()` — открытие модального окна
- `close()` — закрытие модального окна
- `render(data: IModalData): HTMLElement` — рендеринг и возвращение элемента модального окна

#### Класс Page

Класс `Page` — это класс, отвечающий за управление основными элементами страницы сайта (каталогом товаров, корзиной и состоянием блокировки страницы).

Поля класса:

- `_counter` - HTML-элемент счётчика товаров в корзине, защищенный метод
- `_gallery` - HTML-элемент каталога товаров, защищенный метод
- `_wrapper` - HTML-элемент обёртки страницы (для блокировки), защищенный метод
- `_basket` - HTML-элемент иконки корзины, защищенный метод

Методы класса:

- `set counter(value: number)` - устанавливает новое значение счётчика товаров в корзине
- `set catalog(items: HTMLElement[])` - отображает переданные элементы товаров на странице
- `set isLocked(status: boolean)`- блокирует или разблокирует страницу (добавляет/удаляет класс page\_\_wrapper_locked)

#### Класс Card

Класс `Card` — отвечает за отображение карточки товара на странице. Позволяет устанавливать и отображать данные товара (название, описание, изображение, категория, цена, кнопка), а также реализует обработку клика по карточке или кнопке добавления в корзину.
Поля:

- `_description?: HTMLElement` — элемент с описанием товара
- `_image?: HTMLImageElement` — элемент с изображением товара
- `_title: HTMLElement` — элемент с названием товара
- `_category?: HTMLElement` — элемент с категорией товара
- `_price: HTMLElement` — элемент с ценой товара
- `_button?: HTMLButtonElement` — кнопка действия на карточке (например, "Добавить в корзину")

Методы:

- `id: string` — геттер и сеттер id карточки товара (устанавливается в dataset элемента)
- `description: string` — сеттер описания товара
- `image: string` — сеттер изображения товара
- `title: string` — геттер и сеттер названия товара
- `category: string` — сеттер категории товара + добавление соответствующего CSS класса по категории
- `price: number` — сеттер цены товара, устанавливает текст и активность кнопки (если нет цены — кнопка неактивна)
- `button: string` — сеттер текста кнопки действия (например, "Добавить")

#### Класс BasketItem

Класс `BasketItem` — отвечает за отображение карточки товара внутри корзины. Позволяет устанавливать данные товара (название, цена, порядковый номер), а также реализует удаление товара из корзины по клику на кнопку.

Поля:

- `_title: HTMLElement` — элемент с названием товара
- `_price: HTMLElement` — элемент с ценой товара
- `_index: HTMLElement` — элемент с порядковым номером товара в корзине
- `_deleteFromBasketButton: HTMLButtonElement` — кнопка удаления товара из корзины

Методы:

- `title(value: string)` — сеттер названия товара
- `price(value: number)` — сеттер цены товара
- `index(value: number)` — сеттер порядкового номера товара в корзине

#### Класс Basket

Класс `Basket` — отвечает за отображение и управление корзиной товаров. Позволяет устанавливать список товаров и их общую стоимость, оформлять заказ, обновлять индексы товаров при удалении и отключать кнопку оформления заказа.

Поля:

- `_list: HTMLElement` — контейнер для отображения списка товаров в корзине
- `_totalPrice: HTMLElement` — элемент для отображения общей стоимости товаров
- `_orderButton: HTMLButtonElement` — кнопка оформления заказа

Методы:

- `set totalPrice(value: number)` — устанавливает и отображает общую стоимость товаров в корзине
- `set list(list: HTMLElement[])` — устанавливает и отображает список товаров в корзине, а также активирует/деактивирует кнопку оформления заказа в зависимости от наличия товаров

#### Класс OrderForm

Расширяет класс Form.\
Класс `OrderForm` — это форма оформления заказа, которая позволяет пользователю выбрать способ оплаты и ввести адрес доставки. Наследуется от базового класса Form и расширяет его функциональность добавлением логики выбора способа оплаты.

Поля:

- `_cardButton: HTMLButtonElement` — кнопка выбора оплаты картой.
- `_cashButton: HTMLButtonElement` — кнопка выбора оплаты наличными.
- `_input: HTMLInputElement` — поле ввода адреса доставки.

Методы:

- `set address(value: string)` — устанавливает значение поля ввода адреса в форме.
- `set payment(value: PaymentMethod)` — устанавливает текущий способ оплаты и визуально выделяет соответствующую кнопку.

#### Класс ContactsForm

Расширяет класс Form.\
Класс `ContactsForm` — это форма для ввода контактной информации пользователя (телефон и email). Наследуется от Form и добавляет работу с этими полями.

Поля:

- `_inputEmail: HTMLInputElement` — поле для ввода почты
- `_inputPhone: HTMLInputElement` — поле для ввода телефона

Методы:

- `set email(email: string)` — устанавливает значение поля ввода email
- `set phone(phone: string)` — устанавливает значение поля ввода телефона.

#### Класс Success

Класс `Success` представляет компонент успешного оформления заказа. Он отображает финальное сообщение с итоговой суммой и кнопку закрытия. Наследуется от базового класса `Component`.

Поля:

- `_totalPrice: HTMLElement` — DOM-элемент, в который выводится сообщение об итоговой сумме.
- `_button: HTMLButtonElement` — кнопка закрытия окна/сообщения.

Методы:

- `totalPrice(value: number)` — сеттер, отображает текст с информацией о списании суммы в формате Списано <value> синапсов.
